# First Chapter

GitBook allows you to organize your book into chapters, each chapter is stored in a separate file like this one.

***

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这是基于惯性测量单元（IMU）的方向余弦矩阵（DCM）的理论与实现的系列文章的第一篇，DCM能够应用在模型飞机以及直升机上。事实上，这篇文章到目前还只是一个草案，依然还有很多工作要做。许多评论者对于本篇文章的增改提出了很棒的建议，尤其是Louis LeGrand 和一些匿名来信的人，我们应该制作并准备一些文章中还没有包含的图表。我们后面会采纳他们的建议来进行改善，但是这可能还需要花上很长一段时间。在此期间，我们认为我们迄今得到的成果依旧能令很多读者受益。

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;研究DCM的动机是想要将一个带有升降舵和方向舵控制的固有稳定的飞机在稳定和控制功能上更进一步，以使一个带有副翼和升降舵的特技飞机得到稳定控制。本文的其中一个作者（Premerlan）几年前制作了一个适用于两轴的飞控板，并为一个Gentle Lady滑翔机开发了初步的固件来提供稳定性以及返航功能。固件运行得很好，*作者也慢慢的信任其返航功能了*，但是这个功能似乎总不像作者想要的那么好使。尤其是下面两个问题始终找不到满意的解决方案：

* 混合控制。意识到当飞机倾斜转弯的时候，由倾斜角带来了两个问题。第一，由于倾斜，飞机转弯时的偏航旋转对陀螺仪的偏航产生了一个干扰信号。第二，为了完成一个水平的转动，升降舵需要需要一些向上的偏量。这个偏量的大小取决于倾角的大小，而且这个倾角不能直接测量得到。这两个问题好比一个硬币的两面。

* 加速度：加速度计测量的是重力加速度与实际加速度相减所得到的差值。加速度的值等于作用在飞机上总的气动力（升力，推力，阻力等）加上重力 的和再除以飞机的质量最后计算所得到的结果。因此，加速度测量的是作用在飞机上的总的空气动力的负值。重力的测量是在使飞机水平的过程中所需要的，但这不是在飞机加速运动中从从加速度计中获取的值。加速度是一个混杂变量。特别是当飞机上升或者下降的时候，在很短的一段时间内，加速度计的输出没有改变，但是飞机实际上加速了。美国国家航空和航天管理局的宇航员在教练机上也遇到过类似的情况。弹道路径可以产生零净力，因此能够暂时地欺骗加速度计。将加速度问题同混合控制问题结合起来可以避免小角度的俯仰控制，而加速度问题则避免了我们在手动启动飞机的时候使用俯仰自稳。

&emsp;&emsp;意识到问题出现的部分原因是由于我们目前的飞控板没有一个六自由度的惯性测量单元（IMU），因此我们决定重新设计一个新的飞控板，于是乎便有了来自SparkFun的无人机开发板。

&emsp;&emsp;凑巧的是我们的一个研究人员（Premerlani）决定去制作一个带副翼的飞行器，但是发现自己始终掌握不好必要的飞行技能。一个夏天他就坠毁了5架飞机，其中有3次还必须将飞机整个替换掉。因此，为了更加稳定的飞行，他决定将新的飞控板安装在他的Goldberg Endurance飞机上，如下图所示。
<center>![plane](http://i.imgur.com/twFeQru.jpg)</center>
  
&emsp;&emsp;接下的问题是，怎样才能使其发挥出最好的效果？在我们的共同努力下，得到了与Mahony[1]相同的结论。由于我们所需要的是一个“完全遵守旋转群非线性原理”的方法。因此我和Paul觉得我们应该用一个方向余弦矩阵来表示旋转，可以用陀螺仪，加速度计以及GPS的信息来**计算**矩阵的元素，然后用来完成控制和导航。如果大家理解得足够深入，以下便是DCM的工作原理：


  1. 陀螺仪是飞行器方位信息的主要来源。**通过对飞行器的非线性微分动力学方程进行整合，将飞行器的方位对旋转速率的时间变化率以及飞行器当前方位联系起来。**这个操作是在一个较高的频率下进行的，（40到50赫兹）常常足以为电机提供每一个输送过来的PWM脉冲的最新信息。
  
  2. 意识到积分产生的数值误差会逐渐破坏DCM所必须满足的正交约束，我们对矩阵的元素做了一些常规的，小的调整，以使其重新满足约束。
  
  3. 意识到数值误差，陀螺仪漂移，以及陀螺偏移会逐渐累积DCM元素的误差，我们使用参考向量来检测这些误差，在检测到的误差和第1步中陀螺仪的输入之间加了一个PI负反馈调节器，这样可以在误差增加之前更快的将其消除。在此过程中，GPS用于检测偏航误差，加速度用于检测俯仰和横滚的误差。

&emsp;&emsp;整个进程的示意图如图1所示。
<center>![Figure 1](http://i.imgur.com/V48Y1B0.png)</center>
<center> 图1 DCM控制框图 </center>

&emsp;&emsp;毫无疑问，你们应该都想知道什么是旋转群，为什么要使用它。你可能也想知道该如何去使用DCM进行控制和导航。当你也看过Mahony的论文后，你可能跟一些匿名来信的人有着相同的困惑，所以我们将从下面这些问题开始：

* 四元数是什么以及我们为什么用四元数而不是向量符号表示？
* 旋转群的含义是什么？
* 旋转矩阵是什么？
* 保持旋转矩阵的正交性有什么作用？
* 反对称矩阵是什么？
* 你能简要说明旋转矩阵中的运动学原理吗？
* 你能简要说明旋转矩阵中的动力学原理吗？

&emsp;&emsp;所有这一切都与旋转有关。事实上，我们要做的就是将飞机相对于地球的方位表示成一个旋转。有许多方法可以做到这一点。Mahony的论文讨论了两种不同的方法，旋转矩阵还有四元数。这两种表示方法的动机非常相似，它们都能够在不加近似值以及不产生奇点的情况下表示旋转。四元数的优势是其只需要四个变量就能表示一个旋转，而旋转矩阵需要9个。旋转矩阵则有一个天然的适合控制和导航的优势。这里我们选择用旋转矩阵来表示旋转是因为它有着**微弱的优势**，而且其表示方法与人们习惯的方式相似。
<center>![R matrix](http://i.imgur.com/lAHKdRR.png)</center>

&emsp;&emsp;旋转矩阵描述的是一个坐标系相对于另一个坐标系的方位。旋转矩阵的列是其中一个坐标系的单位向量在另一个坐标系的中的投影。一个坐标系中的向量可以通过左乘一个旋转矩阵转移到另一个坐标系。相反的过程可以通过将一个向量左乘这个旋转矩阵的逆矩阵实现，已证明旋转矩阵的逆矩阵与旋转矩阵的转置矩阵是相等的。（矩阵的转置就是将矩阵的行与列交换。）单位向量在控制和导航中非常有用，因为其模长固定等于1。因此通常将它们用来作点乘（·）和叉乘（×）以得到各个角的正弦值或者余弦值。
<center>![transfer](http://i.imgur.com/SElkvQ6.png)</center>
